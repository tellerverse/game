<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>moritz seine spielesammlung</title>
        <link rel="stylesheet" href="style.css">
        <style>
            footer {
                padding: 50px;
                justify-content: center;
            }

            .footercontent {
                padding: 10px;
                color: #fb00ff86;
                text-decoration: none;
                text-align: match-parent;
                font-weight: bold;
                background: #fed3ff51;
                border-radius: 15px;
                border: 3px solid #fb00ff3d;
            }

            .games {
                padding: 32px;
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 24px;
            }

            .game {
                position: relative;
                aspect-ratio: 1 / 1;
                background: #ffffff3e;
                border-radius: 20px;
                display: grid;
                place-items: center;
                box-shadow: 0 15px 40px rgba(0,0,0,.08);
                cursor: pointer;
                transition: transform .2s ease, box-shadow .2s ease;
                background:
                    linear-gradient(
                    to bottom,
                    rgba(0,0,0,0) 0%,
                    var(--bgcolor) 100%
                    ),
                    linear-gradient(
                    180deg,
                    rgb(from var(--color) r g b / 1),
                    rgb(from var(--color) r g b / .5)
                    );

                background-size:
                    100% 100%,
                    100% 400%;

                background-blend-mode: normal;

                animation: cyanShift 6s ease infinite;
            }

            .game:hover {
                animation: none;
                background: rgb(from var(--color) r g b / .75);
                transform: scale(1.05);
                box-shadow: 0 25px 60px rgb(from var(--color) r g b / .75);;
            }

            .game .name {
                font-size: 2.0rem;
                font-weight: 800;
                text-align: center;
                pointer-events: none;
                color: rgb(255, 255, 255);
            }

            .status {
                position: absolute;
                top: -10px;
                right: -10px;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                background: color-mix(
                    in srgb,
                    var(--color) 60%,
                    black
                );

            }

            .icon {
                padding: 20px;
                width: 100%;
                height: 100%;
                /* opacity: .85; */
            }
            @media (max-width: 600px) {
                .games {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 16px;
                    padding: 16px;
                }

                .game {
                    border-radius: 16px;
                }

                .game .name {
                    font-size: 1.5rem;
                }
            }
        </style>
    </head>
    <body>

        <header class="banner large">
            <h1>mor!tz seine<br><span style='font-size:1rem'>&lt;html></span>spielesammlung<span style='font-size:1rem'>&lt;/html></span></h1>
        </header>

        <main class="games">
            <div class="game" data-game="uno">
                <span class="status"></span>
                <div class="icon primary" style="--color: #ffffff; --icon-url: url('Assets/uno.svg')"></div>
                <span class="name">uno</span>
            </div>

            <div class="game" data-game="tik">
                <span class="status"></span>
                <div class="icon primary" style="--color: #ffffff; --icon-url: url('Assets/tiktaktoe.svg')"></div>
                <span class="name">Tic Tac Toe</span>
            </div>

            <div class="game" data-game="sudoku">
                <span class="status"></span>
                <div class="icon primary" style="--color: #ffffff; --icon-url: url('Assets/sudoku.svg')"></div>
                <span class="name">Sudoku</span>
            </div>

            <div class="game" data-game="ship">
                <span class="status"></span>
                <div class="icon primary" style="--color: #ffffff; --icon-url: url('Assets/ship.svg')"></div>
                <span class="name">Schiffe Versenken</span>
            </div>

            <div class="game" data-game="find">
                <span class="status"></span>
                <div class="icon primary" style="--color: #ffffff; --icon-url: url('Assets/search.svg')"></div>
                <span class="name">Finde den Fehler</span>
            </div>
        </main>

        <footer>
            <div class="footercontent">
                <a href="https://tenor.com/de/view/nope-gif-6204613169731376469" style="color: #fb00ff86"><span style='font-size:1.4rem'>&#x2197; Help</span></a><br><br>
                © tellerverse.github.io v1.0<br>
                alle rechte und son zeug vorbehalten © 2026<br>
                made by <a href="/linktree/index.html" style="color: #fb00ff86">moritz</a>
            </div>
        </footer>

        <script type="module">
            import { ref, get, onValue } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";
            import { db } from "./firebasedata.js";

            document.querySelectorAll(".game").forEach(el => {
                el.onclick = () => {
                    location.href = location.hostname.endsWith("github.io") ? `/game/${el.dataset.game}` : `/${el.dataset.game}`;
                };
            });

            function colordots() {
                document.querySelectorAll(".game").forEach(gameEl => {
                    const gameId = gameEl.dataset.game;
                    if (!gameId) return;

                    const colorRef = ref(db, `games/${gameId}/info/color`);

                    onValue(colorRef, snap => {
                        if (!snap.exists()) return;
                        gameEl.style.setProperty("--color", snap.val());
                    });
                });
            }
            colordots()
            onValue(ref(db, "games"), async snap => {
                const games = snap.val() || {};
                const waitingPerGame = {};
                const colors = {
                    1: "#ffff00",
                    2: "#ff7700",
                    3: "#ff0000"
                };
                console.log("change in games")
                for (const [gameId, gameObj] of Object.entries(games)) {
                    if (!gameObj?.sessions) continue;

                    let count = 0;
                    for (const session of Object.values(gameObj.sessions)) {
                        if (session.players) {
                            count += Object.keys(session.players).length;
                        }
                    }

                    const colorSnap = await get(ref(db, `games/${gameId}/info/color`));
                    const baseColor = colorSnap.exists() ? colorSnap.val() : "";

                    waitingPerGame[gameId] = colors[count] ?? baseColor;
                }


                document.querySelectorAll(".game").forEach(el => {
                    const dot = el.querySelector(".status");
                    const game = el.dataset.game;
                    if (!dot) return;
                    if (waitingPerGame[game] != "") dot.style.background = waitingPerGame[game]

                    // dot.classList.toggle("online", !!waitingPerGame[game]);
                    // console.log(`game=${game} waiting=${!!waitingPerGame[game]}`);
                });
            });
        </script>
    </body>
</html>
